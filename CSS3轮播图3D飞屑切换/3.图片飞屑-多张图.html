<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <style>
    body,ul{margin:0;padding:0;}
    li{list-style:none;}
    #wrap{width:570px;height:420px;margin:50px auto;position:relative;}
    .list{width:570px;height:420px;perspective:600px;transform-style:preserve-3d;position:absolute;left:0;top:0;}
    .list li{width:55px;height:58px;float:left;border:1px solid rgba(0,0,0,0);background:url(./images/1.jpg) no-repeat;background-origin:border-box;transition:.5s background,.2s border,.3s .1s box-shadow,2s .3s transform,2s .3s opacity;}/*这里设置了background-origin为border-box，让背景图相对于边框来定位；使用transition进行了多种属性的过度动画*/
    #wrap input{width:60px;height:60px;border-radius:50%;position:absolute;top:100px;z-index:10;}
    #wrap input:nth-of-type(1){left:-100px;}
    #wrap input:nth-of-type(2){right:-100px;}
    /*给不同ul下的li设置不同的背景图*/
    .list:nth-of-type(2) li{background-image:url(./images/2.jpg);}
    .list:nth-of-type(3) li{background-image:url(./images/3.jpg);}
    .list:nth-of-type(4) li{background-image:url(./images/4.jpg);}
    .list:nth-of-type(5) li{background-image:url(./images/5.jpg);}
    </style>
</head>
<body>
    由于transitionEnd事件，需要加前缀，这里只写了webkit的，所以只兼容chrome
    <div id="wrap">
        <input type="button" name="" value="上一张">
        <ul class="list">
            <!-- 70个li，横10个，竖7个 -->
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <ul class="list">
            <!-- 70个li，横10个，竖7个 -->
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <ul class="list">
            <!-- 70个li，横10个，竖7个 -->
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <ul class="list">
            <!-- 70个li，横10个，竖7个 -->
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <ul class="list">
            <!-- 70个li，横10个，竖7个 -->
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <input type="button" name="" value="下一张">
    </div>
</body>
<script type="text/javascript">
    var oList=document.getElementById('wrap');
    var aUl=oList.getElementsByTagName('ul');
    var aInput=document.getElementsByTagName('input');
    var iRows=oList.offsetHeight/aUl[0].children[0].offsetHeight;  //获取行数
    var iCeils=aUl[0].children.length/iRows;  //获取列数
    var iNow=0;  //当前显示第几张
    var aXyLi=[];
    // 函数封装，给所有的li设置坐标，并且给每个li以不同的定位设置背景图，组成一幅图；并返回一个保存着所有li的二维数组，可通过arr[x][y]获取相应的li对象
    function setXy(objs,iRows,iCeils){
        var arr=[];  //二维数组，用来保存所有的li
        for(var i=0;i<iRows;i++){
            var arr2=[];
            for(var j=0;j<iCeils;j++){
                // 将坐标存到对应的li上
                objs[i*iCeils+j].xIndex=j;  //当前li的x坐标就是j
                objs[i*iCeils+j].yIndex=i;  //当前li的y坐标就是i
                objs[i*iCeils+j].style.backgroundPosition=-(j*57)+'px -'+(i*60)+'px';  //在循环中给每个li的背景进行不同的定位，达到所有li的背景恰好组成为一张图的效果
                arr2.push(objs[i*iCeils+j]);  //将当前li对象推入到arr2中，每次循环推入一个，最后得到arr2数组的下标对应当前行的li所在位置的列数
            }
            arr.push(arr2);  //将arr2推入arr中，for循环后arr中有iRows个arr2，每个arr2在arr中的下标就是这个arr2所在的行数
        }
        return arr;
    }
    // 函数封装，用于实现li元素不断的切换样式；arr即oXyLi中的元素执行fn，iDelay是延迟；iSpeedX和iSpeedY迭代的图片（-1即为左边和上边，1即为右边和下边）
    function tab(arr,x,y,fn,iDelay,iSpeedX,iSpeedY){
        if(!arr[y]||!arr[y][x]){
            return;
        }
        if(fn){
            fn.call(arr[y][x]);  //第arr[y][x]个元素调用fn
            clearTimeout(arr[y][x].timer);
            // 延迟执行，让这个li元素左边和上边的li元素继续执行fn，实现递归切换效果
            arr[y][x].timer=setTimeout(function(){
                tab(arr,x,y+iSpeedY,fn,iDelay,iSpeedX,iSpeedY);
                tab(arr,x+iSpeedX,y,fn,iDelay,iSpeedX,iSpeedY);
            },iDelay);
        }
    }
    // 当消失动画执行完毕后，隐藏消失的那张图片（只改透明度会在点击的时候无法点击正确的图片）
    function end(e){
        if(e.propertyName=="transform"){  //当最后一个tansform动画事件执行完成后才隐藏（因为有多个动画，需要最后一个执行完成）
            // this.parentNode.style.display="none";  //不要使用diaplay:none，会有动画不执行的BUG
            this.parentNode.style.visibility="hidden";
        }
    }
    for(var i=0;i<aUl.length;i++){
        var aLi=aUl[i].getElementsByTagName('li');
        aUl[i].style.zIndex=aUl.length-i;
        aXyLi.push(setXy(aLi,iRows,iCeils));  //给每个ul里的li设置坐标和背景图
        // 给图片添加点击事件
        aUl[i].onclick=(function(i){
            return function(){
                alert(i);
            }
        })(i);
    }
    // 上一张
    aInput[0].onclick=function(){
        if(iNow<=0){
            return;
        }
        iNow--;
        aUl[iNow].style.visibility='visible';
        aUl[iNow].children[0].removeEventListener('webkitTransitionEnd',end,false);
        // 让第iNow张执行显示动画
        tab(aXyLi[iNow],0,0,function(){
            // 让各种属性变回初始状态
            this.style.transition='.5s background,.1s border,.1s box-shadow,1s transform ease-in,1s opacity';  //由于展开和重置的动画速度不同，所以单独设置
            this.style.borderColor='rgba(0,0,0,0)';  //将每个li的边框显示出来
            this.style.boxShadow='0 0 0 blue';  //给每个li设置蓝色阴影效果
            this.style.transform='translate(0,0) rotateX(0deg) rotateY(0deg)';  //让每个li进行transform翻转动画和x,y轴的位移
            this.style.opacity=1;  //让每个li透明
        },50,1,1);
    }
    // 下一张
    aInput[1].onclick=function(){
        // 当为最后一张时，不执行动画
        if(iNow>=aXyLi.length-1){
            return;
        }
        // 让第iNow张执行消失动画
        tab(aXyLi[iNow],iCeils-1,iRows-1,function(){
            // 这里的属性变化都在css中使用了transition来过度，实现了动画效果
            this.style.transition='.5s background,.2s border,.3s .1s box-shadow,2s .3s transform,2s .3s opacity';  //由于展开和重置的动画速度不同，所以单独设置
            this.style.borderColor='rgba(0,0,0,0.8)';  //将每个li的边框显示出来
            this.style.boxShadow='0 0 20px blue';  //给每个li设置蓝色阴影效果
            this.style.transform='translate(-50px,-100px) rotateX(-720deg) rotateY(-540deg)';  //让每个li进行transform翻转动画和x,y轴的位移
            this.style.opacity=0;  //让每个li透明
            if(this.xIndex==0&&this.yIndex==0){  //当左上角的li动画执行完成后
                this.addEventListener('webkitTransitionEnd',end,false);  //监听transitionEnd事件，执行自定义end()函数，令图片彻底隐藏
            }
        },50,-1,-1);
        iNow++;
    }
</script>
</html>