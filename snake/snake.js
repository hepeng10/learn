function Snake(t,e){switch(this.width=map.width,this.head={x:0,y:0},this.newHead={x:0,y:0},this.body=[],this.dir=1,this.newDir=1,this.headColor="#ccc",this.bodyColor="#666",e){case 0:this.speed=1e3,this.maxSpeed=100;break;case 1:this.speed=900,this.maxSpeed=100;break;case 2:this.speed=800,this.maxSpeed=100}this.moveT=null}Snake.prototype.init=function(){this.head.x=2*this.width,this.head.y=0,cxt.beginPath(),cxt.fillStyle=this.headColor,cxt.fillRect(this.head.x,this.head.y,this.width,this.width),cxt.closePath();for(var t=0;2>t;t++)this.body[t]={},this.body[t].x=t*this.width,this.body[t].y=0,cxt.beginPath(),cxt.fillStyle=this.bodyColor,cxt.fillRect(this.body[t].x,this.body[t].y,this.width,this.width),cxt.closePath();this.move(),this.changeDir()},Snake.prototype.move=function(){var t=this;this.moveT=setInterval(function(){switch(t.newDir){case 0:var e=t.isDir({x:0,y:-t.width});1==e?t.dir=t.newDir:t.newDir=t.dir;break;case 1:var e=t.isDir({x:t.width,y:0});1==e?t.dir=t.newDir:t.newDir=t.dir;break;case 2:var e=t.isDir({x:0,y:t.width});1==e?t.dir=t.newDir:t.newDir=t.dir;break;case 3:var e=t.isDir({x:-t.width,y:0});1==e?t.dir=t.newDir:t.newDir=t.dir}switch(t.dir){case 0:if(!t.isMove({x:0,y:-t.width}))return!1;t.reDraw({x:0,y:-t.width});break;case 1:if(!t.isMove({x:t.width,y:0}))return!1;t.reDraw({x:t.width,y:0});break;case 2:if(!t.isMove({x:0,y:t.width}))return!1;t.reDraw({x:0,y:t.width});break;case 3:if(!t.isMove({x:-t.width,y:0}))return!1;t.reDraw({x:-t.width,y:0})}},this.speed)},Snake.prototype.reDraw=function(t){this.newHead.x=this.head.x+t.x,this.newHead.y=this.head.y+t.y,cxt.clearRect(0,0,640,640),map.draw(),food.reCreate(),this.isEat(),cxt.beginPath(),cxt.fillStyle=this.headColor,cxt.fillRect(this.newHead.x,this.newHead.y,this.width,this.width),cxt.closePath();for(var e=0;e<this.body.length-1;e++)cxt.beginPath(),cxt.fillStyle=this.bodyColor,cxt.fillRect(this.body[e+1].x,this.body[e+1].y,this.width,this.width),cxt.closePath(),this.body[e].x=this.body[e+1].x,this.body[e].y=this.body[e+1].y;cxt.beginPath(),cxt.fillStyle=this.bodyColor,cxt.fillRect(this.head.x,this.head.y,this.width,this.width),cxt.closePath(),this.body[this.body.length-1].x=this.head.x,this.body[this.body.length-1].y=this.head.y,this.head.x=this.newHead.x,this.head.y=this.newHead.y},Snake.prototype.changeDir=function(){function t(t){function i(t){var h=t.changedTouches[0],d=h.pageX,r=h.pageY;d-s>0&&Math.abs(d-s)>Math.abs(r-a)?e.newDir=1:0>d-s&&Math.abs(d-s)>Math.abs(r-a)?e.newDir=3:r-a>0&&Math.abs(r-a)>Math.abs(d-s)?e.newDir=2:0>r-a&&Math.abs(r-a)>Math.abs(d-s)&&(e.newDir=0),document.removeEventListener("touchend",i,!1)}var h=t.changedTouches[0],s=h.pageX,a=h.pageY;document.addEventListener("touchend",i,!1)}var e=this;document.addEventListener("touchstart",t,!1)},Snake.prototype.isDir=function(t){return this.newHead.x=this.head.x+t.x,this.newHead.y=this.head.y+t.y,this.newHead.x==this.body[this.body.length-1].x&&this.newHead.y==this.body[this.body.length-1].y?!1:!0},Snake.prototype.isMove=function(t){return this.newHead.x=this.head.x+t.x,this.newHead.y=this.head.y+t.y,this.newHead.x>=640||this.newHead.x<0||this.newHead.y<0||this.newHead.y>=640?(clearInterval(this.moveT),alert("Game Over"),reStart(),!1):this.isTail()?!0:(clearInterval(this.moveT),alert("Game Over"),reStart(),!1)},Snake.prototype.isEat=function(){this.newHead.x==food.x&&this.newHead.y==food.y&&(oScore.innerHTML=parseInt(oScore.innerHTML)+1,this.body.unshift({x:this.body[0].x,y:this.body[0].y}),food=new Food,food.create(),this.speed>this.maxSpeed&&(this.speed-=25),clearInterval(this.moveT),this.move())},Snake.prototype.isTail=function(){for(var t=0;t<this.body.length;t++)if(this.newHead.x==this.body[t].x&&this.newHead.y==this.body[t].y)return!1;return!0};